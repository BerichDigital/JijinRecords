From 9e153f90e505ada577f42022ebfdde9db9505947 Mon Sep 17 00:00:00 2001
From: BerichDigital <berichdigital@gmail.com>
Date: Wed, 28 May 2025 14:06:45 +0800
Subject: [PATCH] =?UTF-8?q?=E4=BF=AE=E5=A4=8D=E5=A4=9A=E8=AE=BE=E5=A4=87?=
 =?UTF-8?q?=E6=95=B0=E6=8D=AE=E5=90=8C=E6=AD=A5=E9=97=AE=E9=A2=98=20-=20?=
 =?UTF-8?q?=E9=87=8D=E6=9E=84=E4=BA=91=E7=AB=AF=E5=90=8C=E6=AD=A5=E9=80=BB?=
 =?UTF-8?q?=E8=BE=91=EF=BC=8C=E4=BD=BF=E7=94=A8=E5=9F=BA=E4=BA=8EAPI?=
 =?UTF-8?q?=E5=AF=86=E9=92=A5=E7=9A=84=E5=9B=BA=E5=AE=9AbinId=E7=94=9F?=
 =?UTF-8?q?=E6=88=90=E7=AD=96=E7=95=A5=20-=20=E7=A1=AE=E4=BF=9D=E6=89=80?=
 =?UTF-8?q?=E6=9C=89=E4=BD=BF=E7=94=A8=E7=9B=B8=E5=90=8CAPI=E5=AF=86?=
 =?UTF-8?q?=E9=92=A5=E7=9A=84=E8=AE=BE=E5=A4=87=E8=AE=BF=E9=97=AE=E5=90=8C?=
 =?UTF-8?q?=E4=B8=80=E4=B8=AA=E6=95=B0=E6=8D=AE=E5=AD=98=E5=82=A8=20-=20?=
 =?UTF-8?q?=E6=94=B9=E8=BF=9B=E9=94=99=E8=AF=AF=E5=A4=84=E7=90=86=E5=92=8C?=
 =?UTF-8?q?=E8=BF=9E=E6=8E=A5=E6=B5=8B=E8=AF=95=E5=8A=9F=E8=83=BD=20-=20?=
 =?UTF-8?q?=E6=9B=B4=E6=96=B0README=E6=96=87=E6=A1=A3=EF=BC=8C=E6=B7=BB?=
 =?UTF-8?q?=E5=8A=A0=E8=AF=A6=E7=BB=86=E7=9A=84=E5=90=8C=E6=AD=A5=E4=BD=BF?=
 =?UTF-8?q?=E7=94=A8=E8=AF=B4=E6=98=8E=E5=92=8C=E6=95=85=E9=9A=9C=E6=8E=92?=
 =?UTF-8?q?=E9=99=A4=E6=8C=87=E5=8D=97?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 README.md                    | 193 +++++++++++++++++++----------------
 src/components/CloudSync.tsx |  41 +++++---
 src/lib/cloud-sync.ts        | 180 +++++++++++++++++++++++++-------
 3 files changed, 279 insertions(+), 135 deletions(-)

diff --git a/README.md b/README.md
index cb87549..93a56fb 100644
--- a/README.md
+++ b/README.md
@@ -1,145 +1,157 @@
 # åŸºé‡‘æŠ•èµ„è®°å½•åŠ©æ‰‹
 
-ä¸€ä¸ªç®€å•æ˜“ç”¨çš„åŸºé‡‘æŠ•èµ„è®°å½•ç®¡ç†å·¥å…·ï¼Œå¸®åŠ©æ‚¨è·Ÿè¸ªåŸºé‡‘æŠ•èµ„ç»„åˆçš„è¡¨ç°ã€‚
+ä¸€ä¸ªç®€æ´æ˜“ç”¨çš„åŸºé‡‘æŠ•èµ„è®°å½•ç®¡ç†å·¥å…·ï¼Œæ”¯æŒå¤šè®¾å¤‡æ•°æ®åŒæ­¥ã€‚
 
 ## åŠŸèƒ½ç‰¹ç‚¹
 
-- ğŸ“Š **æŠ•èµ„æ¦‚è§ˆ**ï¼šæŸ¥çœ‹æ€»æŠ•å…¥ã€å½“å‰å¸‚å€¼ã€æ€»ç›ˆäºå’Œæ”¶ç›Šç‡
-- ğŸ’¼ **æŒä»“ç®¡ç†**ï¼šè¯¦ç»†çš„åŸºé‡‘æŒä»“ä¿¡æ¯å’Œå®æ—¶ç›ˆäºè®¡ç®—
-- ğŸ“ **äº¤æ˜“è®°å½•**ï¼šå®Œæ•´çš„ä¹°å…¥å–å‡ºäº¤æ˜“å†å²
-- â˜ï¸ **äº‘ç«¯åŒæ­¥**ï¼šæ”¯æŒ JSONBin.io å…è´¹äº‘ç«¯æ•°æ®åŒæ­¥ï¼Œå¤šè®¾å¤‡è®¿é—®
-- ğŸ”„ **å®æ—¶æ›´æ–°**ï¼šæ‰‹åŠ¨æ›´æ–°åŸºé‡‘å‡€å€¼ï¼Œè·å¾—å‡†ç¡®çš„æ”¶ç›Šè®¡ç®—
-- ğŸ’¾ **æœ¬åœ°å­˜å‚¨**ï¼šæ•°æ®å®‰å…¨ä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°
+- ğŸ“Š **æŠ•èµ„æ¦‚è§ˆ**: å®æ—¶æ˜¾ç¤ºæ€»æŠ•å…¥ã€å¸‚å€¼ã€ç›ˆäºå’Œæ”¶ç›Šç‡
+- ğŸ’¼ **æŒä»“ç®¡ç†**: è¯¦ç»†è®°å½•æ¯åªåŸºé‡‘çš„æŒä»“ä¿¡æ¯
+- ğŸ“ **äº¤æ˜“è®°å½•**: å®Œæ•´çš„ä¹°å…¥å–å‡ºå†å²è®°å½•
+- â˜ï¸ **äº‘ç«¯åŒæ­¥**: å¤šè®¾å¤‡é—´è‡ªåŠ¨åŒæ­¥æ•°æ®
+- ğŸ’¾ **æœ¬åœ°å­˜å‚¨**: æ•°æ®å®‰å…¨ä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°
 
 ## å¿«é€Ÿå¼€å§‹
 
-### 1. å®‰è£…ä¾èµ–
+### å®‰è£…ä¾èµ–
 
 ```bash
 npm install
 ```
 
-### 2. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
+### å¯åŠ¨å¼€å‘æœåŠ¡å™¨
 
 ```bash
 npm run dev
 ```
 
-### 3. è®¿é—®åº”ç”¨
+è®¿é—® [http://localhost:3000](http://localhost:3000) å¼€å§‹ä½¿ç”¨ã€‚
 
-æ‰“å¼€æµè§ˆå™¨è®¿é—® [http://localhost:3000](http://localhost:3000)
+## æ•°æ®åŒæ­¥åŠŸèƒ½
 
-## äº‘ç«¯åŒæ­¥è®¾ç½®
+### é¦–æ¬¡é…ç½®
 
-è¦ä½¿ç”¨äº‘ç«¯æ•°æ®åŒæ­¥åŠŸèƒ½ï¼Œæ‚¨éœ€è¦è·å–å…è´¹çš„ JSONBin.io API å¯†é’¥ï¼š
+1. **è·å– API å¯†é’¥**
+   - è®¿é—® [JSONBin.io](https://jsonbin.io)
+   - å…è´¹æ³¨å†Œè´¦æˆ·
+   - åœ¨æ§åˆ¶å°ä¸­æ‰¾åˆ° "API Keys"
+   - å¤åˆ¶ "X-Master-Key" å¯†é’¥
 
-### æ­¥éª¤ 1ï¼šæ³¨å†Œ JSONBin.io è´¦æˆ·
+2. **é…ç½®åŒæ­¥**
+   - ç‚¹å‡»é¡µé¢å³ä¸Šè§’çš„"æ•°æ®åŒæ­¥"æŒ‰é’®
+   - è¾“å…¥æ‚¨çš„ API å¯†é’¥
+   - ç‚¹å‡»"ä¿å­˜é…ç½®"
 
-1. è®¿é—® [JSONBin.io](https://jsonbin.io)
-2. ç‚¹å‡» "Sign Up" å…è´¹æ³¨å†Œè´¦æˆ·
-3. éªŒè¯é‚®ç®±å¹¶ç™»å½•
+### å¤šè®¾å¤‡åŒæ­¥
 
-### æ­¥éª¤ 2ï¼šè·å– API å¯†é’¥
+**é‡è¦**: æ‰€æœ‰è®¾å¤‡å¿…é¡»ä½¿ç”¨ç›¸åŒçš„ API å¯†é’¥æ‰èƒ½åŒæ­¥æ•°æ®ï¼
 
-1. ç™»å½•åè¿›å…¥æ§åˆ¶å°
-2. åœ¨å·¦ä¾§èœå•ä¸­æ‰¾åˆ° "API Keys"
-3. å¤åˆ¶ "X-Master-Key" å¯†é’¥
+#### è®¾å¤‡Aï¼ˆé¦–æ¬¡è®¾ç½®ï¼‰
+1. é…ç½® API å¯†é’¥
+2. æ·»åŠ ä¸€äº›åŸºé‡‘æ•°æ®
+3. ç‚¹å‡»"ä¸Šä¼ åˆ°äº‘ç«¯"
 
-### æ­¥éª¤ 3ï¼šé…ç½®åº”ç”¨
+#### è®¾å¤‡Bï¼ˆåŒæ­¥æ•°æ®ï¼‰
+1. ä½¿ç”¨ç›¸åŒçš„ API å¯†é’¥è¿›è¡Œé…ç½®
+2. ç‚¹å‡»"ä»äº‘ç«¯ä¸‹è½½"
+3. æ•°æ®å°†è‡ªåŠ¨åŒæ­¥åˆ°æœ¬è®¾å¤‡
 
-1. åœ¨åº”ç”¨ä¸­ç‚¹å‡»"æ•°æ®åŒæ­¥"æ ‡ç­¾é¡µ
-2. ç‚¹å‡»"é…ç½® API"æŒ‰é’®
-3. è¾“å…¥æ‚¨çš„ API å¯†é’¥
-4. ä¿å­˜é…ç½®
+### åŒæ­¥ç­–ç•¥
 
-### æ­¥éª¤ 4ï¼šå¼€å§‹åŒæ­¥
+- **ä¸Šä¼ **: å°†å½“å‰è®¾å¤‡çš„æ•°æ®ä¿å­˜åˆ°äº‘ç«¯
+- **ä¸‹è½½**: ä»äº‘ç«¯è·å–æœ€æ–°æ•°æ®å¹¶è¦†ç›–æœ¬åœ°æ•°æ®
+- **è‡ªåŠ¨æ£€æµ‹**: é…ç½®æ—¶ä¼šè‡ªåŠ¨æ£€æµ‹äº‘ç«¯æ˜¯å¦å·²æœ‰æ•°æ®
 
-1. ä½¿ç”¨"ä¸Šä¼ æ•°æ®"æŒ‰é’®å°†æœ¬åœ°æ•°æ®ä¿å­˜åˆ°äº‘ç«¯
-2. åœ¨å…¶ä»–è®¾å¤‡ä¸Šä½¿ç”¨"ä¸‹è½½æ•°æ®"æŒ‰é’®è·å–æœ€æ–°æ•°æ®
+### æ•…éšœæ’é™¤
 
-## ä½¿ç”¨è¯´æ˜
+#### é—®é¢˜1: ä¸åŒè®¾å¤‡é—´æ•°æ®æ— æ³•åŒæ­¥
 
-### æ·»åŠ äº¤æ˜“è®°å½•
+**åŸå› **: è®¾å¤‡ä½¿ç”¨äº†ä¸åŒçš„ API å¯†é’¥
 
-1. ç‚¹å‡»"æ·»åŠ äº¤æ˜“"æŒ‰é’®
-2. å¡«å†™åŸºé‡‘ä»£ç ã€åç§°ã€äº¤æ˜“ç±»å‹ç­‰ä¿¡æ¯
-3. æäº¤åç³»ç»Ÿä¼šè‡ªåŠ¨è®¡ç®—æŒä»“å’Œæ”¶ç›Š
+**è§£å†³æ–¹æ¡ˆ**:
+1. ç¡®ä¿æ‰€æœ‰è®¾å¤‡ä½¿ç”¨å®Œå…¨ç›¸åŒçš„ API å¯†é’¥
+2. åœ¨æ¯ä¸ªè®¾å¤‡ä¸Šé‡æ–°é…ç½®ï¼Œä½¿ç”¨ç›¸åŒçš„å¯†é’¥
+3. å…ˆåœ¨ä¸€ä¸ªè®¾å¤‡ä¸Šä¸Šä¼ æ•°æ®ï¼Œå†åœ¨å…¶ä»–è®¾å¤‡ä¸Šä¸‹è½½
 
-### æ›´æ–°åŸºé‡‘å‡€å€¼
+#### é—®é¢˜2: ä¸Šä¼ å¤±è´¥
 
-1. åœ¨"æŒä»“è¯¦æƒ…"é¡µé¢æ‰¾åˆ°è¦æ›´æ–°çš„åŸºé‡‘
-2. ç‚¹å‡»å‡€å€¼æ—è¾¹çš„ç¼–è¾‘æŒ‰é’®
-3. è¾“å…¥æœ€æ–°å‡€å€¼å¹¶ç¡®è®¤
+**å¯èƒ½åŸå› **:
+- API å¯†é’¥é”™è¯¯
+- ç½‘ç»œè¿æ¥é—®é¢˜
+- JSONBin.io æœåŠ¡æš‚æ—¶ä¸å¯ç”¨
 
-### æ•°æ®åŒæ­¥
+**è§£å†³æ–¹æ¡ˆ**:
+1. æ£€æŸ¥ API å¯†é’¥æ˜¯å¦æ­£ç¡®
+2. ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
+3. ç¨åé‡è¯•
 
-- **ä¸Šä¼ æ•°æ®**ï¼šå°†æœ¬åœ°æ•°æ®ä¿å­˜åˆ°äº‘ç«¯
-- **ä¸‹è½½æ•°æ®**ï¼šä»äº‘ç«¯è·å–æœ€æ–°æ•°æ®
+#### é—®é¢˜3: ä¸‹è½½å¤±è´¥
+
+**å¯èƒ½åŸå› **:
+- äº‘ç«¯æ²¡æœ‰æ•°æ®
+- API å¯†é’¥é”™è¯¯
+- ç½‘ç»œè¿æ¥é—®é¢˜
+
+**è§£å†³æ–¹æ¡ˆ**:
+1. ç¡®è®¤å·²åœ¨å…¶ä»–è®¾å¤‡ä¸Šä¼ è¿‡æ•°æ®
+2. æ£€æŸ¥ API å¯†é’¥æ˜¯å¦ä¸ä¸Šä¼ è®¾å¤‡ä¸€è‡´
+3. ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
+
+### æ•°æ®å®‰å…¨
+
+- æ•°æ®é€šè¿‡ HTTPS åŠ å¯†ä¼ è¾“
+- JSONBin.io æä¾›å®‰å…¨çš„æ•°æ®å­˜å‚¨
+- API å¯†é’¥ä»…å­˜å‚¨åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­
+- å»ºè®®å®šæœŸå¤‡ä»½é‡è¦æ•°æ®
+
+### æœåŠ¡é™åˆ¶
+
+JSONBin.io å…è´¹è´¦æˆ·é™åˆ¶:
+- æ¯æœˆ 10,000 æ¬¡ API è°ƒç”¨
+- å•ä¸ª bin æœ€å¤§ 100KB
+- å¯¹äºä¸ªäººä½¿ç”¨å®Œå…¨è¶³å¤Ÿ
 
 ## æŠ€æœ¯æ ˆ
 
-- **å‰ç«¯æ¡†æ¶**ï¼šNext.js 15 + React 19
-- **UI ç»„ä»¶**ï¼šshadcn/ui + Tailwind CSS
-- **çŠ¶æ€ç®¡ç†**ï¼šZustand
-- **è¡¨å•å¤„ç†**ï¼šReact Hook Form
-- **äº‘ç«¯åŒæ­¥**ï¼šJSONBin.io API
-- **é€šçŸ¥ç³»ç»Ÿ**ï¼šSonner
+- **æ¡†æ¶**: Next.js 15 + React 19
+- **æ ·å¼**: Tailwind CSS + shadcn/ui
+- **çŠ¶æ€ç®¡ç†**: Zustand
+- **äº‘ç«¯å­˜å‚¨**: JSONBin.io
+- **é€šçŸ¥**: Sonner
+- **å›¾æ ‡**: Lucide React
 
-## é¡¹ç›®ç»“æ„
+## å¼€å‘
+
+### é¡¹ç›®ç»“æ„
 
 ```
 src/
-â”œâ”€â”€ app/                 # Next.js åº”ç”¨é¡µé¢
+â”œâ”€â”€ app/                 # Next.js App Router
 â”œâ”€â”€ components/          # React ç»„ä»¶
 â”‚   â”œâ”€â”€ ui/             # shadcn/ui ç»„ä»¶
-â”‚   â””â”€â”€ CloudSync.tsx   # äº‘ç«¯åŒæ­¥ç»„ä»¶
+â”‚   â””â”€â”€ CloudSync.tsx   # æ•°æ®åŒæ­¥ç»„ä»¶
 â”œâ”€â”€ lib/                # å·¥å…·åº“
-â”‚   â””â”€â”€ cloud-sync.ts   # äº‘ç«¯åŒæ­¥ API å°è£…
+â”‚   â””â”€â”€ cloud-sync.ts   # äº‘ç«¯åŒæ­¥é€»è¾‘
 â””â”€â”€ store/              # Zustand çŠ¶æ€ç®¡ç†
     â””â”€â”€ fund.ts         # åŸºé‡‘æ•°æ®çŠ¶æ€
 ```
 
-## æ•°æ®å®‰å…¨
-
-- æ‰€æœ‰æ•°æ®é»˜è®¤ä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ä¸­
-- äº‘ç«¯åŒæ­¥æ˜¯å¯é€‰åŠŸèƒ½ï¼Œä½¿ç”¨å…è´¹çš„ JSONBin.io æœåŠ¡
-- API å¯†é’¥ä¿å­˜åœ¨æœ¬åœ°ï¼Œä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨
-- æ”¯æŒéšæ—¶å¯¼å‡ºå’Œå¤‡ä»½æ•°æ®
-
-## äº‘ç«¯æœåŠ¡è¯´æ˜
-
-### JSONBin.io å…è´¹é¢åº¦
-
-- æ¯æœˆ 10,000 æ¬¡å…è´¹ API è°ƒç”¨
-- æ¯ä¸ª Bin æœ€å¤§ 100KB å­˜å‚¨ç©ºé—´
-- æ— éœ€ä¿¡ç”¨å¡ï¼Œå®Œå…¨å…è´¹ä½¿ç”¨
-- é€‚åˆä¸ªäººé¡¹ç›®å’Œå°å‹åº”ç”¨
+### æ·»åŠ æ–°åŠŸèƒ½
 
-### æ•°æ®å­˜å‚¨
+1. åœ¨ `src/store/fund.ts` ä¸­æ·»åŠ æ–°çš„çŠ¶æ€
+2. åœ¨ç›¸åº”ç»„ä»¶ä¸­ä½¿ç”¨çŠ¶æ€
+3. æ›´æ–° `cloud-sync.ts` ä¸­çš„æ•°æ®ç±»å‹å®šä¹‰
 
-- æ•°æ®ä»¥ JSON æ ¼å¼å­˜å‚¨åœ¨äº‘ç«¯
-- è‡ªåŠ¨ç‰ˆæœ¬ç®¡ç†å’Œå¤‡ä»½
-- æ”¯æŒå®æ—¶åŒæ­¥å’Œå†²çªæ£€æµ‹
+## éƒ¨ç½²
 
-## å¼€å‘
-
-### æ„å»ºç”Ÿäº§ç‰ˆæœ¬
-
-```bash
-npm run build
-```
-
-### ä»£ç æ£€æŸ¥
+### Vercel éƒ¨ç½²
 
-```bash
-npm run check
-```
+1. å°†ä»£ç æ¨é€åˆ° GitHub
+2. åœ¨ Vercel ä¸­å¯¼å…¥é¡¹ç›®
+3. è‡ªåŠ¨éƒ¨ç½²å®Œæˆ
 
-### ç±»å‹æ£€æŸ¥
+### å…¶ä»–å¹³å°
 
-```bash
-npm run typecheck
-```
+é¡¹ç›®æ˜¯æ ‡å‡†çš„ Next.js åº”ç”¨ï¼Œå¯ä»¥éƒ¨ç½²åˆ°ä»»ä½•æ”¯æŒ Node.js çš„å¹³å°ã€‚
 
 ## è®¸å¯è¯
 
@@ -147,4 +159,11 @@ MIT License
 
 ## è´¡çŒ®
 
-æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼
\ No newline at end of file
+æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼
+
+## æ›´æ–°æ—¥å¿—
+
+### v1.0.0
+- åŸºç¡€åŠŸèƒ½å®ç°
+- å¤šè®¾å¤‡æ•°æ®åŒæ­¥
+- JSONBin.io é›†æˆ
\ No newline at end of file
diff --git a/src/components/CloudSync.tsx b/src/components/CloudSync.tsx
index 16c66b3..f1ff030 100644
--- a/src/components/CloudSync.tsx
+++ b/src/components/CloudSync.tsx
@@ -50,19 +50,36 @@ export function CloudSync() {
       return
     }
 
-    const config: CloudSyncConfig = {
-      apiKey: apiKey.trim()
-    }
+    try {
+      const config: CloudSyncConfig = {
+        apiKey: apiKey.trim()
+      }
 
-    cloudSync.setConfig(config)
-    setIsConfigured(true)
-    setShowConfig(false)
-    toast.success('é…ç½®å·²ä¿å­˜ï¼ç°åœ¨å¯ä»¥å¼€å§‹åŒæ­¥æ•°æ®äº†')
-    
-    // é‡æ–°åŠ è½½äº‘ç«¯ä¿¡æ¯
-    setTimeout(() => {
-      loadCloudInfo()
-    }, 500)
+      cloudSync.setConfig(config)
+      setIsConfigured(true)
+      setShowConfig(false)
+      
+      // æµ‹è¯•è¿æ¥
+      toast.loading('æ­£åœ¨æµ‹è¯•è¿æ¥...', { id: 'test-connection' })
+      
+      const hasData = await cloudSync.hasCloudData()
+      
+      toast.dismiss('test-connection')
+      
+      if (hasData) {
+        toast.success('é…ç½®æˆåŠŸï¼æ£€æµ‹åˆ°äº‘ç«¯å·²æœ‰æ•°æ®ï¼Œå¯ä»¥ä¸‹è½½åŒæ­¥')
+      } else {
+        toast.success('é…ç½®æˆåŠŸï¼äº‘ç«¯æš‚æ— æ•°æ®ï¼Œå¯ä»¥ä¸Šä¼ æœ¬åœ°æ•°æ®')
+      }
+      
+      // é‡æ–°åŠ è½½äº‘ç«¯ä¿¡æ¯
+      setTimeout(() => {
+        loadCloudInfo()
+      }, 500)
+    } catch (error) {
+      console.error('é…ç½®å¤±è´¥:', error)
+      toast.error('é…ç½®å¤±è´¥ï¼Œè¯·æ£€æŸ¥ API å¯†é’¥æ˜¯å¦æ­£ç¡®')
+    }
   }
 
   const handleUpload = async () => {
diff --git a/src/lib/cloud-sync.ts b/src/lib/cloud-sync.ts
index 0f511b0..f9096a2 100644
--- a/src/lib/cloud-sync.ts
+++ b/src/lib/cloud-sync.ts
@@ -48,42 +48,126 @@ class CloudSync {
     return !!(this.config?.apiKey)
   }
 
-  // ä¸Šä¼ æ•°æ®åˆ°äº‘ç«¯
-  async uploadData(data: FundData): Promise<boolean> {
+  // ç”ŸæˆåŸºäºAPIå¯†é’¥çš„å›ºå®šbinId
+  private generateBinId(apiKey: string): string {
+    // ä½¿ç”¨APIå¯†é’¥çš„ä¸€éƒ¨åˆ†ç”Ÿæˆä¸€è‡´çš„binId
+    // è¿™ç¡®ä¿æ‰€æœ‰ä½¿ç”¨ç›¸åŒAPIå¯†é’¥çš„è®¾å¤‡éƒ½ä¼šä½¿ç”¨åŒä¸€ä¸ªbinId
+    const hash = this.simpleHash(apiKey + 'jijin-records')
+    return hash.substring(0, 24) // JSONBin.ioçš„binIdé•¿åº¦é€šå¸¸æ˜¯24ä½
+  }
+
+  // ç®€å•çš„å“ˆå¸Œå‡½æ•°
+  private simpleHash(str: string): string {
+    let hash = 0
+    for (let i = 0; i < str.length; i++) {
+      const char = str.charCodeAt(i)
+      hash = ((hash << 5) - hash) + char
+      hash = hash & hash // è½¬æ¢ä¸º32ä½æ•´æ•°
+    }
+    return Math.abs(hash).toString(16).padStart(24, '0')
+  }
+
+  // ç¡®ä¿binå­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»º
+  private async ensureBinExists(): Promise<boolean> {
     if (!this.config?.apiKey) {
-      throw new Error('è¯·å…ˆè®¾ç½® API å¯†é’¥')
+      return false
     }
 
+    // ç”Ÿæˆå›ºå®šçš„binId
+    const binId = this.generateBinId(this.config.apiKey)
+    
     try {
-      const url = this.config.binId 
-        ? `${this.baseUrl}/b/${this.config.binId}`
-        : `${this.baseUrl}/b`
+      // é¦–å…ˆæ£€æŸ¥binæ˜¯å¦å­˜åœ¨
+      const checkResponse = await fetch(`${this.baseUrl}/b/${binId}`, {
+        method: 'HEAD',
+        headers: {
+          'X-Master-Key': this.config.apiKey
+        }
+      })
 
-      const method = this.config.binId ? 'PUT' : 'POST'
+      if (checkResponse.ok) {
+        // binå­˜åœ¨ï¼Œä¿å­˜binId
+        this.config.binId = binId
+        this.setConfig(this.config)
+        return true
+      }
 
-      const response = await fetch(url, {
-        method,
+      // binä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°çš„bin
+      const createResponse = await fetch(`${this.baseUrl}/b`, {
+        method: 'POST',
         headers: {
           'Content-Type': 'application/json',
           'X-Master-Key': this.config.apiKey,
-          'X-Bin-Name': 'jijin-records-data'
+          'X-Bin-Name': 'jijin-records-shared-data'
         },
-        body: JSON.stringify(data)
+        body: JSON.stringify({
+          _metadata: {
+            appName: "åŸºé‡‘æŠ•èµ„è®°å½•åŠ©æ‰‹",
+            version: "1.0.0",
+            created: new Date().toISOString()
+          },
+          transactions: [],
+          holdings: [],
+          accountSummary: {
+            totalInvestment: 0,
+            totalValue: 0,
+            totalProfit: 0,
+            totalProfitRate: 0
+          },
+          fundPrices: {}
+        })
       })
 
-      if (response.ok) {
-        const result = await response.json()
-        
-        // å¦‚æœæ˜¯é¦–æ¬¡åˆ›å»ºï¼Œä¿å­˜ bin ID
-        if (!this.config.binId && result.metadata?.id) {
-          this.config.binId = result.metadata.id
-          this.setConfig(this.config)
-        }
-        
+      if (createResponse.ok) {
+        const result = await createResponse.json()
+        this.config.binId = result.metadata?.id || binId
+        this.setConfig(this.config)
         return true
       }
-      
+
+      return false
+    } catch (error) {
+      console.error('ç¡®ä¿binå­˜åœ¨å¤±è´¥:', error)
       return false
+    }
+  }
+
+  // ä¸Šä¼ æ•°æ®åˆ°äº‘ç«¯
+  async uploadData(data: FundData): Promise<boolean> {
+    if (!this.config?.apiKey) {
+      throw new Error('è¯·å…ˆè®¾ç½® API å¯†é’¥')
+    }
+
+    try {
+      // ç¡®ä¿binå­˜åœ¨
+      const binExists = await this.ensureBinExists()
+      if (!binExists || !this.config.binId) {
+        throw new Error('æ— æ³•åˆ›å»ºæˆ–è®¿é—®æ•°æ®å­˜å‚¨')
+      }
+
+      const uploadData = {
+        _metadata: {
+          appName: "åŸºé‡‘æŠ•èµ„è®°å½•åŠ©æ‰‹",
+          version: "1.0.0",
+          lastUpdated: new Date().toISOString(),
+          deviceInfo: {
+            userAgent: typeof window !== 'undefined' ? window.navigator.userAgent : 'Unknown',
+            timestamp: Date.now()
+          }
+        },
+        ...data
+      }
+
+      const response = await fetch(`${this.baseUrl}/b/${this.config.binId}`, {
+        method: 'PUT',
+        headers: {
+          'Content-Type': 'application/json',
+          'X-Master-Key': this.config.apiKey
+        },
+        body: JSON.stringify(uploadData)
+      })
+
+      return response.ok
     } catch (error) {
       console.error('ä¸Šä¼ æ•°æ®å¤±è´¥:', error)
       return false
@@ -92,11 +176,28 @@ class CloudSync {
 
   // ä»äº‘ç«¯ä¸‹è½½æ•°æ®
   async downloadData(): Promise<FundData | null> {
-    if (!this.config?.apiKey || !this.config?.binId) {
-      throw new Error('è¯·å…ˆè®¾ç½® API å¯†é’¥æˆ–å°šæœªä¸Šä¼ è¿‡æ•°æ®')
+    if (!this.config?.apiKey) {
+      throw new Error('è¯·å…ˆè®¾ç½® API å¯†é’¥')
     }
 
     try {
+      // ç¡®ä¿binå­˜åœ¨
+      const binExists = await this.ensureBinExists()
+      if (!binExists || !this.config.binId) {
+        // å¦‚æœbinä¸å­˜åœ¨ï¼Œè¿”å›ç©ºæ•°æ®
+        return {
+          transactions: [],
+          holdings: [],
+          accountSummary: {
+            totalInvestment: 0,
+            totalValue: 0,
+            totalProfit: 0,
+            totalProfitRate: 0
+          },
+          fundPrices: {}
+        }
+      }
+
       const response = await fetch(`${this.baseUrl}/b/${this.config.binId}/latest`, {
         headers: {
           'X-Master-Key': this.config.apiKey
@@ -105,7 +206,11 @@ class CloudSync {
 
       if (response.ok) {
         const result = await response.json()
-        return result.record
+        const data = result.record
+        
+        // ç§»é™¤å…ƒæ•°æ®ï¼Œåªè¿”å›åŸºé‡‘æ•°æ®
+        const { _metadata, ...fundData } = data
+        return fundData
       }
       
       return null
@@ -117,19 +222,13 @@ class CloudSync {
 
   // æ£€æŸ¥äº‘ç«¯æ˜¯å¦æœ‰æ•°æ®
   async hasCloudData(): Promise<boolean> {
-    if (!this.config?.apiKey || !this.config?.binId) {
+    if (!this.config?.apiKey) {
       return false
     }
 
     try {
-      const response = await fetch(`${this.baseUrl}/b/${this.config.binId}`, {
-        method: 'HEAD',
-        headers: {
-          'X-Master-Key': this.config.apiKey
-        }
-      })
-
-      return response.ok
+      const binExists = await this.ensureBinExists()
+      return binExists
     } catch (error) {
       return false
     }
@@ -137,11 +236,16 @@ class CloudSync {
 
   // è·å–äº‘ç«¯æ•°æ®ä¿¡æ¯
   async getCloudDataInfo(): Promise<any> {
-    if (!this.config?.apiKey || !this.config?.binId) {
+    if (!this.config?.apiKey) {
       return null
     }
 
     try {
+      const binExists = await this.ensureBinExists()
+      if (!binExists || !this.config.binId) {
+        return null
+      }
+
       const response = await fetch(`${this.baseUrl}/b/${this.config.binId}`, {
         headers: {
           'X-Master-Key': this.config.apiKey
@@ -150,9 +254,13 @@ class CloudSync {
 
       if (response.ok) {
         const result = await response.json()
+        const metadata = result.record?._metadata
         return {
-          lastUpdated: result.metadata?.createdAt,
-          size: JSON.stringify(result.record).length
+          lastUpdated: metadata?.lastUpdated || result.metadata?.createdAt,
+          size: JSON.stringify(result.record).length,
+          binId: this.config.binId,
+          deviceInfo: metadata?.deviceInfo,
+          appVersion: metadata?.version
         }
       }
       
-- 
2.45.2.windows.1

